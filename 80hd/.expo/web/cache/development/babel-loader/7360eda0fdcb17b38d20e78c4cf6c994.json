{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nvar _jsxFileName = \"/Users/naomiperez/Documents/GitHub/80/client/80hd/src/containers/Home.js\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport React, { useState } from 'react';\nimport View from \"react-native-web/dist/exports/View\";\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport Calendar from \"../modules/calendar/Calendar\";\nimport Mood from \"./MoodSelector/Mood\";\nimport Theme from \"../styles/colors\";\nimport LoggerView from \"../components/LoggerView\";\nimport firebase from \"firebase/app\";\nimport 'firebase/firestore';\nimport 'firebase/auth';\nimport { CurrentUserProvider, useCurrentUser } from \"../CurrentUserContext\";\nvar today = new Date();\nvar moodInit = 10;\n\nfunction Home(props) {\n  var _useState = useState(moodInit),\n      _useState2 = _slicedToArray(_useState, 2),\n      mood = _useState2[0],\n      setMood = _useState2[1];\n\n  var _useState3 = useState(today),\n      _useState4 = _slicedToArray(_useState3, 2),\n      date = _useState4[0],\n      setDate = _useState4[1];\n\n  var _useCurrentUser = useCurrentUser(),\n      currentUser = _useCurrentUser.currentUser,\n      fetchCurrentUser = _useCurrentUser.fetchCurrentUser;\n\n  var userRef = currentUser;\n  React.useEffect(function () {\n    fetchCurrentUser();\n  }, []);\n\n  function getTodayLog() {\n    var db, todayRef;\n    return _regeneratorRuntime.async(function getTodayLog$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            db = firebase.firestore();\n            _context.next = 3;\n            return _regeneratorRuntime.awrap(db.collection('moodLog').where(\"timestamp\", \"==\", date).get().then(function (querySnapshot) {\n              if (querySnapshot.docs.length === 0) {\n                console.log(\"No Documents from today\");\n                return undefined;\n              } else if (querySnapshot.docs.length > 1) {\n                console.log(\"More than one document from today\");\n              }\n\n              return querySnapshot.docs[0];\n            }).catch(function (error) {\n              console.log(\"Error getting documents: \", error);\n            }));\n\n          case 3:\n            todayRef = _context.sent;\n            return _context.abrupt(\"return\", todayRef);\n\n          case 5:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  }\n\n  function logMood(mood) {\n    console.log(\"Mood: \" + mood + \" Date: \" + date);\n    setMood(mood);\n    var data = formatLogData();\n    getTodayLog().then(function (todayRef) {\n      if (todayRef) {\n        todayRef.update(data).then(function () {\n          console.log(\"Document successfully updated\");\n        }).catch(function (error) {\n          console.error(\"Error updating document: \", error);\n        });\n      } else {\n        firebase.firestore().collection('moodLog').doc().set(data);\n      }\n    });\n  }\n\n  function formatLogData() {\n    var day = date.getDay();\n    var formattedDate = date.getFullYear().toString() + '-' + date.getMonth().toString() + '-' + date.getDate().toString();\n\n    if (userRef) {\n      console.log(\"userRef: \" + userRef);\n      var data = {\n        date: formattedDate,\n        mood: mood,\n        weekday: day,\n        user: userRef\n      };\n      return data;\n    } else {\n      var user = props.user;\n      console.log(\"user: \" + user);\n      var _data = {\n        date: formattedDate,\n        mood: mood,\n        weekday: day,\n        user: user\n      };\n      return _data;\n    }\n  }\n\n  function logDate(obj) {\n    console.log(obj.date);\n    setDate(obj.date);\n  }\n\n  return React.createElement(CurrentUserProvider, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 115,\n      columnNumber: 9\n    }\n  }, React.createElement(View, {\n    style: styles.container,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 116,\n      columnNumber: 13\n    }\n  }, React.createElement(Calendar, {\n    date: date,\n    logDate: logDate,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 118,\n      columnNumber: 17\n    }\n  }), React.createElement(LoggerView, {\n    selector: React.createElement(Mood, {\n      mood: mood,\n      logMood: logMood,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 119,\n        columnNumber: 39\n      }\n    }),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 119,\n      columnNumber: 17\n    }\n  })));\n}\n\nvar styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    backgroundColor: Theme.cream\n  }\n});\nexport default Home;","map":{"version":3,"sources":["/Users/naomiperez/Documents/GitHub/80/client/80hd/src/containers/Home.js"],"names":["React","useState","Calendar","Mood","Theme","LoggerView","firebase","CurrentUserProvider","useCurrentUser","today","Date","moodInit","Home","props","mood","setMood","date","setDate","currentUser","fetchCurrentUser","userRef","useEffect","getTodayLog","db","firestore","collection","where","get","then","querySnapshot","docs","length","console","log","undefined","catch","error","todayRef","logMood","data","formatLogData","update","doc","set","day","getDay","formattedDate","getFullYear","toString","getMonth","getDate","weekday","user","logDate","obj","styles","container","StyleSheet","create","flex","backgroundColor","cream"],"mappings":"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","sourcesContent":["import React, { useState } from 'react';\nimport { View, StyleSheet } from 'react-native';\nimport Calendar from '../modules/calendar/Calendar'\nimport Mood from './MoodSelector/Mood'\nimport Theme from '../styles/colors'\nimport LoggerView from '../components/LoggerView'\nimport firebase from \"firebase/app\"\nimport 'firebase/firestore'\nimport 'firebase/auth'\nimport { CurrentUserProvider, useCurrentUser } from '../CurrentUserContext'\n\nconst today = new Date();\nconst moodInit = 10;\n\nfunction Home(props) {\n    // Use state variables to store date and mood\n    const [mood, setMood] = useState(moodInit)\n    const [date, setDate] = useState(today)\n    const { currentUser, fetchCurrentUser } = useCurrentUser()\n\n    const userRef = currentUser\n\n    // \n    React.useEffect(() => {\n        fetchCurrentUser()\n\n    }, [])\n\n    /* Returns  */\n    async function getTodayLog() {\n        const db = firebase.firestore()\n\n        // If user has already logged something today, then get the document\n        // with today's date from the 'moodLog' Firestore collection\n\n        const todayRef = await db.collection('moodLog').where(\"timestamp\", \"==\", date).get()\n            .then(querySnapshot => {\n                if (querySnapshot.docs.length === 0) {\n                    console.log(\"No Documents from today\")\n                    return undefined\n                } else if (querySnapshot.docs.length > 1) {\n                    console.log(\"More than one document from today\")\n                }\n\n                return querySnapshot.docs[0]\n                //  id & data properties\n            })\n            .catch((error) => {\n                console.log(\"Error getting documents: \", error);\n            });\n\n            return todayRef\n    }\n\n    /********************/\n    function logMood(mood) {\n        console.log(`Mood: ${mood} Date: ${date}`)\n\n        setMood(mood)\n\n        let data = formatLogData()\n        /* If user already has logged data for today, then update() \n            if not, then add() new document for today\n        */\n        getTodayLog().then((todayRef) => {\n            if (todayRef) {\n                todayRef.update(data)\n                    .then(() => {\n                        console.log(\"Document successfully updated\");\n                    }).catch((error) => {\n                        // The document probably doesn't exist.\n                        console.error(\"Error updating document: \", error);\n                    });\n            } else {\n                // New doc for 'today''s date\n                firebase.firestore().collection('moodLog').doc().set(data)\n            }\n        })\n    }\n\n    function formatLogData() {\n        /* Format date to pass to document.add() */\n        let day = date.getDay()\n        const formattedDate = date.getFullYear().toString() + '-' + date.getMonth().toString() + '-' + date.getDate().toString()\n        /* Check if this component was returned by Registration/Login or App.js */\n        if (userRef) {\n            console.log(\"userRef: \" + userRef)\n            // Create new data for day and add it as a document\n            let data = {\n                date: formattedDate,\n                mood: mood,\n                weekday: day,\n                user: userRef\n            }\n            return data\n        } else {\n            let user = props.user\n            console.log(\"user: \" + user)\n            let data = {\n                date: formattedDate,\n                mood: mood,\n                weekday: day,\n                user: user\n            }\n            return data\n        }\n    }\n\n    function logDate(obj) {\n        console.log(obj.date)\n        setDate(obj.date)\n    }\n\n    return (\n        <CurrentUserProvider>\n            <View style={styles.container}>\n                {/* import the context and pass along the data */}\n                <Calendar date={date} logDate={logDate} />\n                <LoggerView selector={<Mood mood={mood} logMood={logMood} />} />\n            </View>\n        </CurrentUserProvider>\n    );\n}\n\n\nconst styles = StyleSheet.create({\n    container: {\n        flex: 1,\n        backgroundColor: Theme.cream\n    }\n});\n\nexport default Home;"]},"metadata":{},"sourceType":"module"}